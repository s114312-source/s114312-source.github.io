<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>åˆ‡æ°´æœéŠæˆ²</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background-color: #000; font-family: sans-serif; }
        
        /* é ‚éƒ¨æ•¸æ“š */
        #hud {
            position: fixed; top: 10px; width: 100%;
            display: flex; justify-content: space-between;
            padding: 0 20px; box-sizing: border-box;
            z-index: 10; pointer-events: none;
        }
        .info {
            color: white; font-size: 24px; font-weight: bold;
            background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 10px;
        }

        /* ç•«å¸ƒ */
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* é¸å–®èˆ‡çµæŸç•«é¢ */
        .overlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #222; color: white; padding: 40px; border-radius: 20px;
            text-align: center; z-index: 100; border: 2px solid white;
            min-width: 250px; display: block;
        }
        input { width: 80px; padding: 10px; font-size: 18px; margin: 10px; text-align: center; }
        
        /* é†’ç›®çš„æŒ‰éˆ• */
        .big-btn {
            background: white; color: black; border: none;
            padding: 15px 40px; font-size: 20px; font-weight: bold;
            cursor: pointer; border-radius: 10px; margin-top: 20px;
        }
        .big-btn:hover { background: #ccc; }
    </style>
</head>
<body>

    <div id="hud">
        <div id="scoreDisplay" class="info">å¾—åˆ†: 0</div>
        <div id="timerDisplay" class="info">æ™‚é–“: --</div>
    </div>

    <div id="startUI" class="overlay">
        <h1 style="margin-top:0">æ°´æœæŒ‘æˆ°</h1>
        <p>è¨­å®šç§’æ•¸ï¼š</p>
        <input type="number" id="timeInput" value="60">
        <p style="color:#ff5555; font-size:14px">å°å¿ƒç‚¸å½ˆ ğŸ’£ æœƒæ‰£ 20 åˆ†ï¼</p>
        <button id="startBtn" class="big-btn">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="overUI" class="overlay" style="display:none">
        <h1>æ™‚é–“çµæŸ</h1>
        <p id="finalScoreText" style="font-size:24px"></p>
        <button id="restartBtn" class="big-btn">é‡æ–°æŒ‘æˆ°</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        // 1. åŸºæœ¬è¨­å®š
        console.log("éŠæˆ²è…³æœ¬å·²è¼‰å…¥...");
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startUI = document.getElementById('startUI');
        const overUI = document.getElementById('overUI');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const timeInput = document.getElementById('timeInput');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timerDisplay = document.getElementById('timerDisplay');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let score = 0;
        let timeLeft = 0;
        let gameActive = false;
        let items = [];
        let particles = [];
        let mouseTrail = [];
        let timerTicker;

        const FRUITS = ['ğŸ', 'ğŸŠ', 'ğŸ‰', 'ğŸ', 'ğŸ“', 'ğŸ¥', 'ğŸ‡', 'ğŸ‹'];

        // 2. æ ¸å¿ƒå‡½æ•¸ï¼šé–‹å§‹éŠæˆ²
        function runGame() {
            console.log("å˜—è©¦é–‹å§‹éŠæˆ²...");
            score = 0;
            timeLeft = parseInt(timeInput.value) || 60;
            gameActive = true;
            items = [];
            particles = [];
            
            scoreDisplay.innerText = "å¾—åˆ†: 0";
            timerDisplay.innerText = "æ™‚é–“: " + timeLeft;
            
            startUI.style.display = 'none';
            overUI.style.display = 'none';

            // å€’æ•¸è¨ˆæ™‚
            if (timerTicker) clearInterval(timerTicker);
            timerTicker = setInterval(() => {
                if (gameActive) {
                    timeLeft--;
                    timerDisplay.innerText = "æ™‚é–“: " + timeLeft;
                    if (timeLeft <= 0) gameOver();
                }
            }, 1000);

            animate();
        }

        function gameOver() {
            gameActive = false;
            clearInterval(timerTicker);
            document.getElementById('finalScoreText').innerText = "æœ€çµ‚å¾—åˆ†: " + score;
            overUI.style.display = 'block';
        }

        // 3. ç¶å®šæŒ‰éˆ•é»æ“Šäº‹ä»¶ (é€™æ˜¯æœ€ä¿éšªçš„å¯«æ³•)
        startBtn.addEventListener('click', () => {
            runGame();
        });

        restartBtn.addEventListener('click', () => {
            location.reload(); 
        });

        // 4. éŠæˆ²ç‰©ç†é¡åˆ¥
        class Item {
            constructor(isBomb = false) {
                this.x = Math.random() * (canvas.width - 100) + 50;
                this.y = canvas.height + 50;
                this.speedY = -(Math.random() * 3 + 8); // é€Ÿåº¦æ…¢
                this.speedX = (Math.random() - 0.5) * 4;
                this.isBomb = isBomb;
                this.char = isBomb ? 'ğŸ’£' : FRUITS[Math.floor(Math.random() * FRUITS.length)];
                this.angle = 0;
            }
            update() {
                this.speedY += 0.2; // é‡åŠ›
                this.x += this.speedX;
                this.y += this.speedY;
                this.angle += 0.05;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                ctx.font = "60px Arial";
                ctx.textAlign = "center";
                ctx.fillText(this.char, 0, 0);
                ctx.restore();
            }
        }

        class Sliced {
            constructor(x, y, char, side) {
                this.x = x; this.y = y; this.char = char; this.side = side;
                this.speedX = side === 'left' ? -3 : 3;
                this.speedY = -3;
                this.opacity = 1;
            }
            update() {
                this.speedY += 0.2; this.x += this.speedX; this.y += this.speedY;
                this.opacity -= 0.02;
            }
            draw() {
                ctx.save();
                ctx.globalAlpha = Math.max(0, this.opacity);
                ctx.translate(this.x, this.y);
                ctx.font = "60px Arial";
                ctx.textAlign = "center";
                ctx.beginPath();
                if (this.side === 'left') ctx.rect(-60, -60, 60, 120);
                else ctx.rect(0, -60, 60, 120);
                ctx.clip();
                ctx.fillText(this.char, 0, 0);
                ctx.restore();
            }
        }

        // 5. æ»‘é¼ èˆ‡å‹•ç•«
        canvas.addEventListener('mousemove', (e) => {
            if (!gameActive) return;
            const mx = e.clientX;
            const my = e.clientY;
